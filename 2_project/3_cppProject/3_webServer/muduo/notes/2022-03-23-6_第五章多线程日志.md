---
title: "(6)第五章多线程日志"
subtitle: "muduo阅读笔记"
layout: post
author: "Marco"
header-style: text
hidden: true
tags:
  - 计算机网络
  - linux多线程服务端编程

---

 ## 第五章多线程日志

### 1. 导语

- ***什么是日志？***

  - **诊断日志：**即log4j、glog等，以为本为主，供人阅读的日志，多用于故障诊断和追踪，也可用于性能分析。日志通常是分布式系统中事故调查的唯一线索。
  - **交易日志：**数据库的日志，以记录状态变更为主，通过回放日志实现回滚操作
  - 本文的日志以前者为主

- ***诊断日志要记录什么？***

  ​	生产环境中要做到“log  everything all the time”，也就是说能弄多详细就多详细。对于进程，日志通常要记录

  - 收到的内部信息的id
  - 收到外部信息的全文
  - 关键内部状态的变更

  ​	每条日志都要有时间戳，这样就能够完整追踪分布式系统一个事件的来龙去脉。

- ***日志库有哪些组成？***

  - 前端：供应用程序使用的API，并生成日志信息
  - 后端：负责把日志信息写到目的地

  > 在多线程服务器中，一般来说每个线程都会有这里的前端，而所有程序共用一个后端，这是一个多生产者-单消费者的问题。

### 2. 日志库的功能需求

- ***日志库一般有哪些功能？***

  - 多种日志信息级别：如DEBUG、INFO、WARN等。

    > 测试环境输出DEBUG级别的日志，生产环境输出INFO级别日志等

  - 日志信息可能有多个目的地，如文件，socket，SMTP等

  - 日志信息格式可配置，控制格式

  - 运行时过滤器，控制不同组件的日志信息的级别以及目的地

### 3. 日志库的性能需求

- 每秒写成千上万但没有明显性能损失
- 能应对大量日志数据生成的场景，如1GB/min
- 不阻塞其他流程
- 不会产生竞态，如多个线程同时写时



### 附录

- 对于分布式系统中，日志的目的地只有：本地文件。因为往网络写日志是不可靠的，网络容易出差错。
- 日志需要有滚动操作，即更新，每天一个文件、以及写满1G就跳过等。