所以我将任务队列做成一个链表,生产者在队列尾部加入任务,消费者在队列头部取出任务.

上述代码存在的问题是,只考虑了任务队列开始为空,生产者后来添加了任务,条件变量被唤醒,然后消费者取任务执行的逻辑.假如一开始池中就有任务呢?这个原因导致,只有开始的几个添加到任务队列中任务被执行.因为一旦任务队列不为空.内层while循环条件将不再满足,导致消费者线程不再从任务队列中取任务消费.正确的代码如下:
