## 内存
### 1. 什么是内存

### 2. 内存运行的基本原理

#### 2.1 指令的工作原理
#### 2.2 逻辑地址vs物理地址
#### 2.3 程序运行
编译:由编译程序将用户源代码编译成若干个目标模块(把高级语言翻译为机器语言)

链接:由链接程序将编译后形成的一组目标模块,以及所需库函数链接在一起,形成一个完整的装入模块

装入(装载):由装入程序将装入模块装入内存运行.
##### 2.3.1 编辑源代码
##### 2.3.2 编译
##### 2.3.3 链接
链接的三种方式:
1. 静态链接:在程序运行之前,先将各目标模块及它们所需的库函数连接成一个完整的可执行文件(装入模块),之后不再拆开.
2. 装入时动态链接:将各目标模块装入内存时,边装入边链接的链接方式.
3. 运行时动态链接:在程序执行中需要该目标模块时,才对它进行链接.其优点是便于修改和更新,便于实现对目标模块的共享.
##### 2.3.4 装入

#### 2.4 内存的链接方式
##### 2.4.1 静态链接
##### 2.4.2 装入时动态链接
##### 2.4.3 运行时动态链接


#### 2.5 内存的装入方式
##### 2.5.1 绝对装入
在编译时,如果知道程序将放到内存中的哪个位置,编译程序将产生绝对地址的目标代码.装入程序按照装入模块中的地址,将程序和数据装入内存.
*(只适用于单道程序环境)

##### 2.5.2 可重定位装入(静态装入)
又称可重定位装入.编译/链接后的装入模块的地址都是从0开始的,指令中使用的地址/数据存放的地址都是相对于起始地址而言的逻辑地址.可根据内存的当前情况,将装入模块装入到内存的适当位置.装入时对地址进行"重定位",将逻辑地址变换为物理地址(地址变换是在装入时一次完成的). 静态重定位的特点是在一个作业装入内存时,必须分配其要求的全部内存空间,如果没有足够的内存,就不能装入该作业. 作业一旦进入内存后,在运行期间就不能再移动,也不能再申请内存空间.

##### 2.5.3 动态运行时装入(动态装入)
又称动态运行时装入.编译/链接后的装入模块的地址都是从0开始的.装入程序把装入模块装入内存后,并不会立即把逻辑地址转换为物理地址,而是把地址转换推迟到程序真正要执行 时才进行.因此装入内存后所有的地址依然是逻辑地址.这种方式需要一个重定位寄存器的支持.

*采用动态重定位时允许程序在内存中发生移动


### unorganized
1. 操作系统负责**内存空间的分配与回收**
2. 操作系统需要提供某种技术从逻辑上**对内存空间进行扩充**
3. 操作系统需要提供**地址转换功能**,负责程序的逻辑地址与物理地址的转换
4. 操作系统需要提供**内存保护功能**.保证各进程在各自存储空间内运行,互不干扰

### 覆盖和交换
#### 覆盖
* 为什么要引入覆盖技术?
用来解决"程序大小超过物理内存总和"的问题
* 实现的基本思想时什么?
常用的段常驻内存,不常用的段在需要时调入内存.内存中分为一个"固定区"和若干个"覆盖区".需要常驻内存的段放在"固定区"中,调入后就不再调出(除非运行结束).不常用的段放在"覆盖区",需要用到时调入内存,用不到时调出内存 缺点:缺点:对用户不透明,增加了用户编程负担,只用于早期的操作系统中.

#### 交换

设计思想:内存空间紧张时,系统将内存中某些进程暂时换出外存,把外存中某些已具备运行条件的进程换入内存(进程在内存与磁盘间动态调度).

暂时换出外存等待的进程状态为挂起状态(挂起态,suspend),挂起态又可以进一步细分为就绪挂起/阻塞挂起两种状态
>1:具有对换功能的操作系统中,通常把磁盘空间分为文件区和对换区两部分.文件区主要用于存放文件,主要追求存储空间的利用率,因此对文件区空间的管理采 用离散分配方式;对换区空间只占磁盘空间的小部分,被换出的进程数据就存放在对换区.由于对换的速度直接影响到系统的整体速度,因此对换区空间的管理 主要追求换入换出速度,因此通常对换区采用连续分配方式(学过文件管理章节 后即可理解).总之,对换区的I/O速度比文件区的更快.

#### ques
1. 覆盖和交换的本质区别是什么?
2. 外存指的是硬盘吗
3. 磁盘和硬盘的区别
4. 文件去和交换区的区别
5. 应该什么时候交换?
    交换通常在许多进程运行且内存吃紧时进行,而系统负荷降低就暂停.例如:在 发现许多进程运行时经常发生缺页,就说明内存紧张,此时可以换出一些进程; 如果缺页率明显下降,就可以暂停换出.

6. 应该换出那些进程?
    可优先换出阻塞进程;可换出优先级低的进程;为了防止优先级低的进程在被调 入内存后很快又被换出,有的系统还会考虑进程在内存的驻留时间...(注意:PCB 会常驻内存,不会被换出外存)

### 内存分配管理
#### 1. 连续分配
连续分配:指为用户进程分配的必须是一个连续的内存空间
在单一连续分配方式中,内存被分为系统区和用户区.

系统区通常位于内存的低地址部分,用于存放操作系统相关数据;用户区用于存放用户进程相关数据.内存中只能有一道用户程序,用户程序独占整个用户区空间.

优点:实现简单;无外部碎片;可以采用覆盖技术扩充内存;不一定需要采取内存保护

缺点:只能用于单用户/单任务的操作系统中;有内部碎片;存储器利用率极低.
#### 2. 固定分区分配
整个用户空间划分为若干个固定大小(相等或不相等)的分区,在每个分区中只装入一道作业,这样就形成了最早的/最简单的一种可运行多道程序的内存管理方式.

分区大小相等:缺乏灵活性,但是很适合用于用一台计 算机控制多个相同对象的场合

分区大小不等:增加了灵活性,可以满足不同大小的进程需求.根据常在系统中运行的作业大小情况进行划分

实现方式:

操作系统需要建立一个数据结构__分区说明表,来实现各个分区的分配与回 收.每个表项对应一个分区,通常按分区大小排列.每个表项包括对应分区的大小/起始地址/状态(是否已分配)

优点:实现简单,无外部碎片.
缺点:a. 当用户程序太大时,可能所有的分区都不能满足需求,此时不得不采 用覆盖技术来解决,但这又会降低性能;b. 会产生内部碎片,内存利用率低.

#### 3. 动态分区分配