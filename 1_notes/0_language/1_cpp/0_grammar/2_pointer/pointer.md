## pointers技巧

* **指针的理解**
指针的本质确实可以归结为类型和地址。

首先地址的意义可以根据字面意思理解，但需要注意的是，在内存层面，内存的最小可寻址单元大小是 1 字节。这相当于一个 char 类型所占的空间大小；
至于类型的意义，则在于让编译器知晓该按照何种格式去读取相应地址处的数据。

当涉及到像 int 这样需要多个字节（通常为 4 字节）来存储的数值时，可以通过4个地址表示，但也可以基于内存分配必定连续的先验条件，通过一个类型长度+首地址的方式表示。显然后者更方便，这是为什么指针是类型和地址的意思了。

特别要注意的是，在使用指针时，最好将硬件亲和性纳入考量范围。内存访问并非是简单地逐个地址去获取数据，实际上，内存访问往往是按照一定的 “行” 来进行操作的，例如当通过指针访问 int 类型数据时，并不是分四次去访问对应的四个字节地址，而是一次性访问包含这四个字节的一 “行” 内存空间，字节对齐就是基于这样的内存访问机制而存在的。字节对齐能够确保数据在内存中的存放符合硬件高效访问的要求，从而提升整体的访问效率，让基于指针的内存操作更加顺畅高效。

进一步的，内存访问是查高速缓存再查内存的。这个行的大小长度，实际上应该交由缓存决定更为友好。而缓存行的大小一般为64字节，8个地址长度，16个int型数据。

上面的讨论，意在明确基本概念，提升相关认识。平台差和硬件导致的差异不讨论。

### 1. 数组和指针

`int arr[] = {1,2,3};`
当强调`{1,2,3}`的时候，arr是一个数组。当使用arr进行传递的时候，arr是数组名。

* 指针和数组的关系与区别

简单来说，数组是一种基于指针概念的封装和抽象。
> 其实细究下来，数组其实不能简单说是指针概念的封装和抽象。因为汇编语言提供了数组的概念，但汇编没有指针的概念。那么对于编译器来说，数组大概率不是简单通过指针概念的封装得到的一个概念。
> 但是从计算机模型的角度出发，数组是可以理解为指针概念的抽象的。只是这个抽象指的是能力上，而非实现上的。
> 也就是说，数组和指针的所有对外能力的差异，都可以通过经过封装之后的指针进行补足，实现一样的效果。
> 也就是说封装过后的指针，对外就是和数组就是一样的。

那么指针需要怎样的封装，才能表现出数组的形式呢？
* 数组是一种指针常量，即指向不可被修改。
* 数组是连续相同类型元素的集合，这些内存分配一定是连续的。
* 数组的下标访问和指针运算等效，在本质上，使用数组下标访问元素（如 `arr[i]`）和通过指针运算来访问元素（如 `*(p + i)`，`p` 指向数组首元素）是等效的操作方式，编译器在底层进行处理时，都会转化为相应的地址计算，最终实现对内存中对应元素的访问。
* 数组的大小

因此，指针的理解，数组的理解上面都解释完了。

* 数组退化为指针

* 数组名作为形参和指针作为形参的区别

* 

### 2. 代码例子

#### 2.1 数组的内存分布

```plaintext
Stack:
|----------------|
| int **rowptr   | -> Stack:
|----------------|    |---------------------------              |
| int row        |    | int *[nrows]                            | -> |-----------------------           |
| main frame     |    |---------------------------              |    | int[ncols] (rowptr[0])           |
|                |    | int *[0] (rowptr[0])                    |    | int[ncols] (rowptr[1])           |
|                |    | int *[1] (rowptr[1])                    |    | ...                              |
|                |    |...                                      |    | ...                              |
|                |    | int *[nrows - 1] (rowptr[nrows - 1])    |    | int[ncols] (rowptr[nrows - 1])   |
|                |    |---------------------------              |    |-----------------------           |
```
