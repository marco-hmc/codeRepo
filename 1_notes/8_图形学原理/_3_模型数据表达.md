## 模型数据表达

### 1. 几何对象
几何对象和可绘制对相关联

### 2. 拓扑对象
拓扑对象是几何对象的子集（派生类）。
在计算机图形学和几何建模中，"拓扑对象"可能指的是构成3D模型的顶点、边和面。

#### 2.1 shape
在计算机图形学中，"shape"通常指的是一个三维物体的几何形状。这个词经常在3D建模和渲染中使用。一个shape可以由一组顶点、边和面组成，这些元素共同定义了物体的几何形状。在3D建模软件中，你可以操作这些元素来改变物体的形状。Shape是对物体的全面描述，包括其内部和外部的所有几何信息。

#### 2.2 shell和sheet
在计算机图形学中，"shell"和"sheet"都是用来描述三维物体表面的术语。

"Shell"在计算机图形学中，通常指的是一个三维物体的表面。这个词经常在3D建模和渲染中使用。一个shell可以由一组连接的多边形（通常是三角形或四边形）组成，这些多边形共同定义了物体的外部形状。在3D建模中，当我们只关心物体的外观，而不关心其内部结构时，我们通常会使用shell。

"Shell"通常指的是一个封闭的三维物体的表面。这意味着shell定义了一个完全封闭的空间，没有任何开口。例如，一个立方体或球体的表面就是一个shell。

"Sheet"则通常指的是一个开放的三维物体的表面。这意味着sheet定义了一个部分封闭的空间，有一个或多个开口。例如，一个圆柱体或圆锥体的侧面就是一个sheet。

这两个术语都是在描述三维物体的表面，但是它们关注的是物体是否完全封闭。

#### 2.3 loop


### 3. 包围盒

### 3. 计算机图形学中的shell是什么意思？
### 2. 拓扑对象

## 曲线曲面基础

[toc]

### 1. 曲线曲面基本理论

* **解析曲面和自由型曲线曲面的区别**

  * 解析曲面
    * 仅由初等解析面组成，一般为球和圆锥面等等。
  * 自由型曲线曲面
    * 不能仅由初等解析函数组成的。比如飞机、汽车造型等。

* **曲线和曲面造型的意义**

  * 为了能够在计算机图形系统下对曲线曲面进行一个显示、设计和分析，如何对自由型曲线曲面进行一个数学上的表示是很重要的，那要怎么做呢？
  * 其中最值得介绍的表达方式如下
    * 贝塞尔曲线（Bezier曲线）
    * B样条
    * 有理B样条
    * 非均匀有理B样条（NURBS）
      * 统一了Beizer和B样条曲线曲面的数学表达方法，即Beizer和B样条都是NURBS的特例

* **曲线曲线表达方式**

  * **解析曲面**
    * **有哪些方式**
      * 显式方程
      * 隐式方程
    * **不足**
      * 不直观，容易受坐标变换影响；不同类型曲线拼接如何保证连续性，不能够满足复杂曲面造型表示

  * **拟合方式**
    * **有哪些方式**
      * 插值
      * 逼近
  * **控制点的方式**
    * Bezier
    * B样条
    * Nurbs

  

### 2. Bzier曲线曲面表达

* **Bezier曲线的几何意义**

  * https://www.bilibili.com/video/BV1hL411b7i5/?spm_id_from=333.337.search-card.all.click&vd_source=8215bf938da2fb524fa6ffc652bb3c53
  
* Bezier集合特性
  * 曲线分割

### 3. 均匀B样条曲线曲面表达



### 4. 非均匀B样条曲线曲面表达

* 均匀B样条曲线曲面表达
  * 优缺点以及不足
* 非均匀B样条曲线曲面表达
  * 优缺点以及不足
* Nurbs曲线曲面
  * Nurbs曲线定义





### 5. Q&A

1. **NURBS由哪些要素构成？非均匀有理样条曲线里边包含哪些概念？(均匀与非均匀针对样条曲线的哪个特点描述，有理与非有理针对样条曲线概念的哪个特点描述)** 

   * **非均匀有理样条曲线(NURBS, Non-Uniform-Rational-B-Spline)由以下四要素组成**
     
     * 控制点：控制点是用于定义曲线或曲面形状的关键点。它们的位置决定了曲线的形状。
     * 权重：权重用于调整控制点对曲线形状的影响程度。它们允许曲线在不同部分具有不同的弯曲度和拉伸度。
     * 节点向量：节点是定义曲线参数化的位置，用于控制曲线在空间中的形状和分布。节点构成了参数空间，它们决定了曲线上的点如何与控制点相互作用。
     * 阶数：节点是定义曲线参数化的位置，用于控制曲线在空间中的形状和分布。节点构成了参数空间，它们决定了曲线上的点如何与控制点相互作用。
   * 非均匀概念
     * 非均匀指的是曲线参数空间中的节点分布不均匀，即节点之间的间隔可以不相等。这使得曲线的形状可以根据需要在不同的区域具有不同的密度和精度。
     
     * 有理指的是控制点具有权重（一般不全为1），而无理的则不讨论权重（全为1）。通过控制点的权重，可以实现对曲线形状的更精确控制，使曲线具有更大的灵活性和变化性。
     
       > 经网络搜索，这里的有理和无理与有理数无理数概念无关，更接近有权重无权中。

   

2. **描述一下 Bezier与Spline，再到NURBS，是怎样的包含关系？**

   * **NURBS**是Spline和Bezier的更一般的形式，换句话说就是，Spline和Bezier是Nurbs的特殊形式。
     * **Bezier**：均匀无理
     * **Spline：**非均匀无理
     * **NURBS：**非均匀有理

   

3. **节点插入之后，曲线的位置会有什么变化吗？**

   * 插入节点和调整控制点，NURBS曲线的形状会发生变化。

     具体来说，Nurbs和B-Spline都可以看成是多段Bezier曲线组成的。因此，插入控制点，一般会对该曲线附近区域造成变化。但是，正如下一问，如果这些控制点以及加入的控制点都是在直线上，也是有可能不会发生变化的。

     

4. **bezier曲线的控制顶点均共线，那么定义的bezier曲线会是什么形式？**

   * 直线

   

5. **一次Bezier曲线是什么线？二次Bezier曲线是什么线?**

   * 一次贝塞尔曲线是一条直线段
   * 二次贝塞尔曲线是一条抛物线

   

6. **非有理样条曲线能够精确表述圆，椭圆，抛物线吗？为什么要引入有理样条曲线**

   * 非有理样条曲线无法精确表达圆、椭圆和抛物线等特殊几何形状。
   * 引入有理样条曲线（NURBS）通过有理权重的调整，可以更精准地表示这些几何图形。

   > **有理权重应该如何确定？**
   >
   > * **优化算法：**
   >   * 使用优化算法来自动调整权重，以使曲线与目标形状的误差最小化。也可以通过一些约束条件引入。这可以是通过最小二乘法或其他数值优化方法实现的。优化算法可以根据预定义的目标函数和约束条件，自动搜索最佳的权重设置。



7. **有理样条曲线某一位置的控制点对应的权重值变大，曲线会有什么样的影响**

   * 当有理样条曲线某一位置的控制点对应的权重值变大时，曲线会在该位置处受到更强的影响，可能会发生以下影响：

     1. 弯曲程度增加：增加控制点的权重可以使曲线在该位置处弯曲更强。曲线会更加接近或更深地弯曲以适应该控制点的位置。这可以使曲线形成更尖锐的角度或更明显的弯曲。
     2. 曲线形状改变：增加控制点的权重可能会导致曲线形状在该位置附近发生变化。曲线的局部凸起或凹陷可能会变得更明显，从而改变整体形状。
     3. 曲线位置偏移：如果权重的变化导致控制点相对于其他控制点的影响力增加，那么曲线的位置可能会发生偏移。曲线可能会更接近或更远离该控制点，导致整体曲线的位置变化。
     4. 平滑性影响：增加控制点的权重可能会对曲线的平滑性产生影响。如果权重变化太大或不连续，可能会导致曲线在该位置处出现明显的角度或不连续性，从而影响曲线的整体平滑性。

     需要注意的是，控制点权重的变化会对曲线的形状产生局部影响，而临近控制点的权重变化也会对整体曲线产生一定的影响。因此，在调整控制点权重时，需要综合考虑整个曲线的形状和平滑性，并进行适当的微调，以达到期望的效果。

     总结： 当有理样条曲线某一位置的控制点对应的权重值变大时，曲线在该位置处会发生更明显的弯曲，形状可能会改变，曲线位置可能会偏移，并且平滑性可能会受到影响。权重的变化需要综合考虑整个曲线的效果，并进行适当的微调，以达到所需的曲线形状和平滑性。



8. **(选做题) 升阶算法的基本思路是什么？**

   * 单纯升阶的话，有两种思路

     * 增加控制点
     * 增加阶数（阶数的最大值为控制点数减一）

   * 如果在升阶的同时，要求曲线不发生变化。在Bezier曲线通常这么做

     * ```c++
       /*!
       *\brief bezier曲线升阶
       *\ param const std::vector<Point> & control_vertex 原始控制点
       *\ param std::vector<Point> & new_control_vertex 升阶后的控制点
       *\ Returns:   void
       */
       void Bezier::DegreeElevation(const std::vector<Point>& control_vertex,std::vector<Point>& new_control_vertex)
       {
       	int n = control_vertex.size();
       	new_control_vertex.resize(n+1);
        
       	new_control_vertex.front() = control_vertex.front();
       	new_control_vertex.back() = control_vertex.back();
        
       	for (int i=1;i<n;++i)
       	{
       		double ratio = ((double)i)/n;
       		new_control_vertex[i] = ratio*control_vertex[i-1] + (1.0-ratio)*control_vertex[i];
       	}
       }
       ```

       

### 附录

* `阶数=次数+1`

* B样条基函数的定义域为

  如何理解B样条基函数的定义域，$[u_n, u_m]$
  
* ![img](img/image175.jpg)

  二次NURBS曲线，![img](http://give.zju.edu.cn/cgcourse/new/book/8.7.files/image177.gif)变化

  ![img](img/image179.jpg)

   

  三次NURBS曲线，![img](http://give.zju.edu.cn/cgcourse/new/book/8.7.files/image181.gif)变化

   

  ![img](img\image183.jpg)

  图8.21 NURBS曲面的权因子影响

* nurbs 升阶

  ![image-20230717234851283](img/image-20230717234851283.png)

  曲线的阶越高，代表曲线的光滑程度越高，曲线的计算和储存消耗的资源也越多


[toc]
## 1. Nurbs问答

1. **NURBS由哪些要素构成？非均匀有理样条曲线里边包含哪些概念？(均匀与非均匀针对样条曲线的哪个特点描述，有理与非有理针对样条曲线概念的哪个特点描述)** 

   * **非均匀有理样条曲线(NURBS, Non-Uniform-Rational-B-Spline)由以下四要素组成**
     
     * 控制点：控制点是用于定义曲线或曲面形状的关键点。它们的位置决定了曲线的形状。
     * 权重：权重用于调整控制点对曲线形状的影响程度。它们允许曲线在不同部分具有不同的弯曲度和拉伸度。
     * 节点向量：节点是定义曲线参数化的位置，用于控制曲线在空间中的形状和分布。节点构成了参数空间，它们决定了曲线上的点如何与控制点相互作用。
     * 阶数：节点是定义曲线参数化的位置，用于控制曲线在空间中的形状和分布。节点构成了参数空间，它们决定了曲线上的点如何与控制点相互作用。
   * 非均匀概念
     * 非均匀指的是曲线参数空间中的节点分布不均匀，即节点之间的间隔可以不相等。这使得曲线的形状可以根据需要在不同的区域具有不同的密度和精度。
     
     * 有理指的是控制点具有权重（一般不全为1），而无理的则不讨论权重（全为1）。通过控制点的权重，可以实现对曲线形状的更精确控制，使曲线具有更大的灵活性和变化性。
     
       > 经网络搜索，这里的有理和无理与有理数无理数概念无关，更接近有权重无权中。
   

2. **描述一下 Bezier与Spline，再到NURBS，是怎样的包含关系？**

   * **NURBS**是Spline和Bezier的更一般的形式，换句话说就是，Spline和Bezier是Nurbs的特殊形式。
     * **Bezier**：均匀无理
     * **Spline：**非均匀无理
     * **NURBS：**非均匀有理

   

3. **节点插入之后，曲线的位置会有什么变化吗？**

   * 插入节点和调整控制点，NURBS曲线的形状会发生变化。

     具体来说，Nurbs和B-Spline都可以看成是多段Bezier曲线组成的。因此，插入控制点，一般会对该曲线附近区域造成变化。但是，正如下一问，如果这些控制点以及加入的控制点都是在直线上，也是有可能不会发生变化的。

     

4. **bezier曲线的控制顶点均共线，那么定义的bezier曲线会是什么形式？**

   * 直线

   

5. **一次Bezier曲线是什么线？二次Bezier曲线是什么线?**

   * 一次贝塞尔曲线是一条直线段
   * 二次贝塞尔曲线是一条抛物线

   

6. **非有理样条曲线能够精确表述圆，椭圆，抛物线吗？为什么要引入有理样条曲线**

   * 非有理样条曲线无法精确表达圆、椭圆和抛物线等特殊几何形状。
   * 引入有理样条曲线（NURBS）通过有理权重的调整，可以更精准地表示这些几何图形。

   > **有理权重应该如何确定？**
   >
   > * **优化算法：**
   >   * 使用优化算法来自动调整权重，以使曲线与目标形状的误差最小化。也可以通过一些约束条件引入。这可以是通过最小二乘法或其他数值优化方法实现的。优化算法可以根据预定义的目标函数和约束条件，自动搜索最佳的权重设置。


7. **有理样条曲线某一位置的控制点对应的权重值变大，曲线会有什么样的影响**

   * 当有理样条曲线某一位置的控制点对应的权重值变大时，曲线会在该位置处受到更强的影响，可能会发生以下影响：

     1. 弯曲程度增加：增加控制点的权重可以使曲线在该位置处弯曲更强。曲线会更加接近或更深地弯曲以适应该控制点的位置。这可以使曲线形成更尖锐的角度或更明显的弯曲。
     2. 曲线形状改变：增加控制点的权重可能会导致曲线形状在该位置附近发生变化。曲线的局部凸起或凹陷可能会变得更明显，从而改变整体形状。
     3. 曲线位置偏移：如果权重的变化导致控制点相对于其他控制点的影响力增加，那么曲线的位置可能会发生偏移。曲线可能会更接近或更远离该控制点，导致整体曲线的位置变化。
     4. 平滑性影响：增加控制点的权重可能会对曲线的平滑性产生影响。如果权重变化太大或不连续，可能会导致曲线在该位置处出现明显的角度或不连续性，从而影响曲线的整体平滑性。

     需要注意的是，控制点权重的变化会对曲线的形状产生局部影响，而临近控制点的权重变化也会对整体曲线产生一定的影响。因此，在调整控制点权重时，需要综合考虑整个曲线的形状和平滑性，并进行适当的微调，以达到期望的效果。

     总结： 当有理样条曲线某一位置的控制点对应的权重值变大时，曲线在该位置处会发生更明显的弯曲，形状可能会改变，曲线位置可能会偏移，并且平滑性可能会受到影响。权重的变化需要综合考虑整个曲线的效果，并进行适当的微调，以达到所需的曲线形状和平滑性。


8. **(选做题) 升阶算法的基本思路是什么？**

   * 单纯升阶的话，有两种思路

     * 增加控制点
     * 增加阶数（阶数的最大值为控制点数减一）

   * 如果在升阶的同时，要求曲线不发生变化。在Bezier曲线通常这么做

     * ```c++
       /*!
       *\brief bezier曲线升阶
       *\ param const std::vector<Point> & control_vertex 原始控制点
       *\ param std::vector<Point> & new_control_vertex 升阶后的控制点
       *\ Returns:   void
       */
       void Bezier::DegreeElevation(const std::vector<Point>& control_vertex,std::vector<Point>& new_control_vertex)
       {
       	int n = control_vertex.size();
       	new_control_vertex.resize(n+1);
        
       	new_control_vertex.front() = control_vertex.front();
       	new_control_vertex.back() = control_vertex.back();
        
       	for (int i=1;i<n;++i)
       	{
       		double ratio = ((double)i)/n;
       		new_control_vertex[i] = ratio*control_vertex[i-1] + (1.0-ratio)*control_vertex[i];
       	}
       }
       ```       

## 2. 参数对图形的几何直接影响

* 控制权重

  ![img](C:\Users\marco\Nutstore\1\0_TODO\img\image175.jpg)

  > w越大，越靠近控制节点

* 阶数

  阶数越高，越光滑

* 控制点

  节点向量的位置和分布决定了曲线在参数空间中的采样密度和位置。

#### 怎么理解所有存储在图形系统中的几何数据都以节点的形式存储?上下的背景信息都可以介绍一下

GitHub Copilot: 在计算机图形学中,场景通常被组织为一种称为"场景图"(Scene Graph)的数据结构.场景图是一种树形结构,其中每个节点代表场景中的一个对象或一组对象.这些对象可以是几何形状(如三角形/立方体等)/光源/摄像机或者其他的图形实体.

场景图的一个关键特性是,每个节点的变换(位置/旋转和缩放)是相对于其父节点的.这意味着,如果你移动一个节点,那么所有的子节点也会跟着移动.这使得一些操作变得非常方便,例如旋转一个节点以及其所有的子节点,或者在不改变相对位置的情况下移动一组节点.

在这种结构中,几何数据(即模型的顶点/边和面)通常存储在叶子节点中,而变换/材质和其他属性则存储在内部节点中.当渲染场景时,图形系统会遍历场景图,并将每个节点的变换应用到其几何数据上,然后将结果发送到图形硬件进行渲染.

这种方式的优点是可以方便地组织和管理复杂的场景,以及方便地实现一些复杂的效果,例如层级动画/物体的相对运动等.缺点是需要更多的内存来存储场景图,以及更多的计算资源来处理场景图的遍历和变换的应用.

#### 一般来说包围盒是怎么计算的?

以下是计算包围盒的伪代码:

```cpp
// 初始化包围盒的最小和最大点为物体的第一个顶点
vec3 minPoint = object.vertices[0];
vec3 maxPoint = object.vertices[0];

// 遍历物体的所有顶点
for (int i = 1; i < object.vertices.size(); i++) {
    vec3 vertex = object.vertices[i];

    // 更新包围盒的最小和最大点
    minPoint = min(minPoint, vertex);
    maxPoint = max(maxPoint, vertex);
}

// 创建包围盒
BoundingBox boundingBox;
boundingBox.min = minPoint;
boundingBox.max = maxPoint;
```

在这个伪代码中,`min`和`max`函数分别返回两个向量的分量最小值和最大值.`BoundingBox`是一个简单的结构体,包含一个最小点和一个最大点.