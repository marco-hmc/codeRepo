### mesi协议

MESI协议是一种用于多处理器系统中的缓存一致性协议.
MESI是Modified(修改)/Exclusive(独占)/Shared(共享)和Invalid(无效)四个状态的首字母缩写.

- Modified(修改):当前缓存行是最新的,且与主存中的数据不一致,其他所有缓存中都没有这个数据.
- Exclusive(独占):当前缓存行是最新的,与主存中的数据一致,其他所有缓存中都没有这个数据.
- Shared(共享):当前缓存行是最新的,与主存中的数据一致,可能在其他缓存中也有这个数据.
- Invalid(无效):当前缓存行是无效的,数据可能已经被修改.

MESI协议的目标是在多处理器系统中保持缓存一致性,即当一个处理器修改了它的缓存行中的数据时,其他所有处理器的缓存行中的相同数据都应该被更新或者标记为无效.
这样可以确保所有处理器都能看到最新的数据,避免数据不一致的问题.

### mesi协议是怎么实现的?
MESI协议的实现涉及到处理器/缓存和总线等硬件组件的协同工作.以下是一个简化的实现步骤:

1. 当一个处理器需要读取或写入一个数据项时,它首先会检查自己的缓存中是否有这个数据项.如果有,那么它会根据这个数据项在缓存中的状态(Modified/Exclusive/Shared或Invalid)来决定如何操作.

2. 如果处理器在自己的缓存中没有找到这个数据项,或者这个数据项的状态是Invalid,那么它会发送一个请求到总线上,要求从主存或其他处理器的缓存中获取这个数据项.

3. 当一个处理器看到总线上的请求时,如果它的缓存中有请求的数据项,那么它会根据自己缓存中的数据项的状态来决定如何响应.例如,如果状态是Modified,那么它会将数据写回主存,并将状态改为Shared;如果状态是Exclusive或Shared,那么它会将状态改为Shared.

4. 当请求的处理器收到响应后,它会更新自己的缓存,并将数据项的状态设置为适当的值.例如,如果它是唯一一个拥有这个数据项的处理器,那么状态会被设置为Exclusive;如果有其他处理器也拥有这个数据项,那么状态会被设置为Shared.

5. 当一个处理器要写入一个数据项时,如果这个数据项的状态是Exclusive或Modified,那么它可以直接写入;如果状态是Shared或Invalid,那么它需要先发送一个请求到总线上,告诉其他所有处理器这个数据项已经被修改,其他处理器需要将自己缓存中的这个数据项的状态改为Invalid.

通过以上步骤,MESI协议能够在多处理器系统中保持缓存一致性.

https://www.scss.tcd.ie/Jeremy.Jones/VivioJS/caches/MESI.htm