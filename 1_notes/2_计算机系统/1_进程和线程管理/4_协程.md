## 什么是协程

### 1. 基本概念

- ***什么是协程？***

  ​	协程，英文Coroutines，是一种基于线程之上，但又比线程更加轻量级的存在，这种由程序员自己写程序来管理的轻量级线程叫做『用户空间线程』，具有对内核来说不可见的特性。

  ​	**协程是一种“伪多线程”**

  ![image](https://s2.loli.net/2022/04/05/OqfxTIDrubUXA1n.jpg)

- ***为什么用协程？或者说协程相比多线程的优势是什么？***

  ​	最大的优势就是协程极高的执行效率。因为子程序切换不是线程切换，而是由程序自身控制，因此，没有线程切换的开销，和多线程比，线程数量越多，协程的性能优势就越明显。

  ​	第二大优势就是不需要多线程的锁机制，因为只有一个线程，也不存在同时写变量冲突，在协程中控制共享资源不加锁，只需要判断状态就好了，所以执行效率比多线程高很多。

- ***协程的缺点是什么？***

  ​	多个协程是运行在一个线程上，而一个核心一次只能跑一个协程，也就是说协程是不能利用多核资源的，因为协程本质上是个子例程。

### 2. 实战篇

- ***如何使用协程？***

  ​	不是所有语言都支持协程的，java对协程就不支持。支持协程最好的是Go、Lua、python等语言。而C++20也开始支持协程了。

- ***协程的本质是什么？什么时候用协程？***

  ​	因为离这方面开发的应用比较远，有些东西没办法切身体会。感觉更多像原来ABCD四个线程，因为这四个线程互相配合工作，但线程上下文来回切换比较费时。因此令E线程下面有abcd有四个协程来代替ABCD四个线程。

  ​	而什么时候需要这么替换呢？当ABCD线程需要频繁切换的时候，而abcd协程切换的代价是非常小的。而abcd协程为了避免出现竞态，则依赖于异步调用。而异步调用不是很好实现，最好是依赖于编程语言原生支持。

### 3. ques
#### 3.1 C++的协程的实现原理是什么?
C++的协程是一种特殊的函数,它可以在执行过程中暂停和恢复.协程的实现原理涉及到两个关键概念:生成器和状态机.

生成器是协程的基础,它是一个可以产生多个值的函数.在C++中,生成器使用`yield`语句来暂停执行并返回一个值,然后可以通过调用生成器来恢复执行并继续生成下一个值.生成器的实现通常使用状态机来跟踪函数的执行状态.

状态机是一个用于管理协程执行状态的机制.它可以记录协程的当前状态,并根据不同的状态执行相应的操作.在C++中,状态机通常使用有限状态机(FSM)来实现.FSM由一组状态和状态之间的转换组成.每个状态都对应着协程的不同执行阶段,而状态之间的转换则由协程的控制流决定.

在C++中,协程的实现依赖于协程支持库,如Boost.Coroutine或C++20中引入的标准库中的协程.这些库提供了协程的底层实现,包括生成器和状态机的机制.通过使用这些库,我们可以更方便地编写和管理协程.

总结一下,C++的协程实现原理涉及生成器和状态机的概念.生成器用于产生多个值并支持暂停和恢复执行,而状态机用于管理协程的执行状态和控制流.通过使用协程支持库,我们可以更轻松地编写和管理协程.