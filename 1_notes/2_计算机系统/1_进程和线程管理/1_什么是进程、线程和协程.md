_tags: 操作系统, 进程, 协程, 协程
_label: 1

## 进程、线程和协程

### 1. 什么是进程线程和协程
* 进程:
进程是操作系统进行资源分配和调度的基本单位,是应用程序在操作系统中的一次运行过程.进程拥有自己独立的内存空间,每个进程中都有至少一个线程.进程之间的通信需要使用特殊的进程间通信机制.
  * 优点：
     * 进程是互相独立的，不涉及锁什么之类的，代码编写方便，调试方便
     * 进程是独立的，所以稳定性更高，一个进程挂了，其他也不会挂；
  * 缺点：
     * 进程创建慢，占用内存多，进程的上下文切换代价高昂
     * 进程之间通信麻烦且慢，常用且好的多进程通信机制一般为socket，所以通信内容一般为指令而非数据

* 线程:
线程是进程内的执行单元,是操作系统进行调度的基本单位.一个进程中可以包含多个线程,它们共享进程的内存空间,因此线程间的通信更为方便.但是,多线程编程需要处理好同步和互斥,以避免数据竞争和死锁等问题.
  * 优点
    * 线程创建快，上下文切换快，创建开销小
    * 线程通信快
  * 缺点
    * 要考虑锁机制，代码写起来麻烦
    * 不可靠，一个线程挂了，全挂了

* 协程:
协程(Coroutine)是一种用户态的轻量级线程,协程的调度完全由用户控制.协程有点类似于线程,但协程避免了无意义的调度,而且提供了方便的协作式多任务处理能力.协程在某些场景下,如IO密集型任务,可以提高程序的执行效率.

### 2. 进程、线程和协程的消耗如何？
todo: 
* 进程切换的开销有哪些？
  - 地址空间的转换，如切换页表全局目录，刷新TLB
  - 硬件上下文切换，如切换内核栈，载入寄存器数据
* 线程切换的开销有哪些？
  - 大体与进程一致，相对线程略小
  - 但是要考虑到CPU Cache命中率，如果是线程的切换，CPU Cache不需要怎么更新，命中率更高。
* 协程切换的开销有哪些？
