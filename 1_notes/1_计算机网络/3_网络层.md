## 计算机网络
### 1. concepts

### 2. quiz

### 路由器
路由器是网络中的关键设备,它在网络层(OSI模型的第三层)上工作,主要有以下几个作用:

1. **数据包转发**:路由器的主要功能是接收来自一个网络的数据包,并将其转发到另一个网络.路由器根据数据包的目标IP地址和自己的路由表来决定如何转发数据包.

2. **路由选择**:路由器使用路由协议(如RIP/OSPF/BGP等)来与其他路由器交换路由信息,并根据这些信息来建立和更新自己的路由表.路由表中的每一条路由都指示了如何到达一个特定的网络.

3. **网络连接**:路由器可以连接不同类型(如以太网/Wi-Fi/光纤等)和不同协议(如IPv4/IPv6等)的网络.这使得不同网络中的设备可以互相通信.

4. **网络分割**:路由器可以将一个大网络分割为多个小网络(或子网),每个小网络都有自己的网络地址.这可以提高网络的管理效率和数据传输效率,同时也可以提高网络的安全性.

5. **网络服务**:一些路由器还提供了DHCP/NAT/防火墙等网络服务.

总的来说,路由器是实现网络互联的关键设备,它使得不同网络中的设备可以互相通信.

### 1. 基本概念

1. **IP协议(Internet Protocol)**:IP协议是网络层的核心协议,它定义了IP地址和数据包的格式,并负责将数据包从源主机发送到目标主机.IP协议包括IPv4和IPv6两个版本.

2. **ICMP协议(Internet Control Message Protocol)**:ICMP协议用于发送和接收网络控制消息,如错误报告/路由更改通知等.例如,当你使用ping命令测试网络连通性时,就是使用的ICMP协议.

3. **路由协议**:路由协议用于在路由器之间交换路由信息,以建立路由表.常见的路由协议包括RIP/OSPF/BGP等.

4. **IGMP协议(Internet Group Management Protocol)**:IGMP协议用于管理多播组,它允许主机加入或离开一个多播组,以接收或停止接收多播数据.

5. **ARP协议(Address Resolution Protocol)**:ARP协议用于将IP地址映射为MAC地址.当一个主机需要将数据包发送到同一网络中的另一个主机时,它会使用ARP协议查找目标主机的MAC地址.

6. **RARP协议(Reverse Address Resolution Protocol)**:RARP协议是ARP协议的反向版本,它用于将MAC地址映射为IP地址.RARP协议主要用于无盘工作站在启动时获取IP地址.

以上就是网络层的主要协议.需要注意的是,这些协议都是为了实现网络层的主要功能:将数据包从源主机发送到目标主机,无论它们是否在同一网络中.

### 2. IP
#### 2.1 同一个子网下的IP地址为什么一般都是192.168开始的?
    GitHub Copilot: 192.168.x.x是一个专门为私有网络(如家庭和企业内部网络)预留的IP地址范围,由RFC 1918定义.这个地址范围在全球范围内可以重复使用,但在同一个网络内必须是唯一的.

    除了192.168.x.x,RFC 1918还定义了两个其他的私有IP地址范围:10.x.x.x和172.16.x.x到172.31.x.x.然而,由于192.168.x.x的地址范围较小,足够大多数家庭和小型企业使用,因此它被广泛用作默认的私有IP地址范围.

    当你设置一个网络设备(如路由器)为DHCP服务器时,它通常会默认使用192.168.x.x的地址范围为网络内的设备分配IP地址.这就是为什么同一个子网下的IP地址通常都是以192.168开始的.

#### 2.2 IP寻址和MAC寻址有什么不同,怎么实现的
    IP寻址和MAC寻址是网络通信中两种重要的寻址方式,它们的主要区别在于使用的地址类型/地址分配方式和使用的网络层级.

    **IP寻址**:

    IP寻址使用的是IP地址,这是一个网络层的概念.IP地址是网络中每个设备的唯一标识,它由网络部分和主机部分组成.IP地址可以是IPv4(32位)或IPv6(128位).

    IP地址通常由网络管理员或DHCP服务器动态分配.IP寻址允许设备在任何地方接入网络,只要它们的IP地址是唯一的.

    IP寻址的实现主要依赖于IP协议,它定义了如何将数据包从源IP地址发送到目标IP地址.

    **MAC寻址**:

    MAC寻址使用的是MAC地址,这是一个数据链路层的概念.MAC地址是网络接口控制器(NIC)的唯一标识,它通常是在生产时由制造商硬编码在设备上的.

    MAC地址是48位的,由6个字节组成,通常以十六进制表示.MAC寻址主要用于同一网络中的设备通信.

    MAC寻址的实现主要依赖于以太网协议,它定义了如何将数据帧从源MAC地址发送到目标MAC地址.

    需要注意的是,IP寻址和MAC寻址通常会一起使用.当一个设备需要将数据包发送到另一个设备时,它会使用IP寻址确定目标设备的网络位置,然后使用ARP协议将目标设备的IP地址映射为MAC地址,最后使用MAC寻址将数据包发送到目标设备.

#### 2.3 有了mac地址为什么还要有ip地址?
    IP地址和MAC地址在网络通信中各有其特定的作用和重要性.

    MAC地址是网络设备的物理地址,它是设备制造时被硬编码到网络接口卡(NIC)上的,全球唯一,不会改变.MAC地址主要在数据链路层使用,用于在同一网络(例如,同一局域网)中的设备之间进行通信.

    然而,MAC地址无法满足跨网络(例如,从一个局域网到另一个局域网,或从一个网络到互联网)的通信需求.这是因为在大型网络(如互联网)中,使用MAC地址进行路由选择和数据传输将会非常复杂和低效.

    这就是IP地址的作用所在.IP地址是网络层的地址,它可以跨网络进行通信.IP地址由网络部分和主机部分组成,这使得路由器可以根据IP地址的网络部分进行高效的路由选择.

    总的来说,MAC地址和IP地址共同支持了网络通信.在同一网络中,设备使用MAC地址进行通信;在跨网络通信时,设备使用IP地址确定目标设备的网络位置,然后通过ARP协议将IP地址转换为MAC地址,最后将数据包发送到目标设备.

#### 2.4 DHCP和ARP是怎么分配IP地址的?
GitHub Copilot: DHCP(动态主机配置协议)和ARP(地址解析协议)是网络中两种重要的协议,它们在IP地址的分配和解析中起着关键的作用.

**DHCP的工作流程**:

   1. **DHCP发现(Discover)**:客户端启动时,会在网络上广播DHCP发现消息,寻找可用的DHCP服务器.

   2. **DHCP提供(Offer)**:DHCP服务器收到发现消息后,会向客户端发送一个DHCP提供消息,提供一个可用的IP地址.

   3. **DHCP请求(Request)**:客户端收到提供消息后,会向DHCP服务器发送一个DHCP请求消息,请求使用提供的IP地址.

   4. **DHCP确认(ACK)**:DHCP服务器收到请求消息后,会向客户端发送一个DHCP确认消息,确认客户端可以使用提供的IP地址.

   通过这个过程,DHCP服务器可以动态地为网络中的设备分配IP地址.

**ARP的工作流程**:
    ARP协议用于将网络层的IP地址映射为数据链路层的MAC地址.当一个设备需要将数据包发送到同一网络中的另一个设备时,它会使用ARP协议查找目标设备的MAC地址.

    1. 设备A需要向设备B发送数据,但只知道设备B的IP地址,不知道其MAC地址.

    2. 设备A在网络上广播一个ARP请求消息,询问谁拥有设备B的IP地址.

    3. 所有收到ARP请求的设备都会检查自己的IP地址,如果IP地址匹配,则设备B会向设备A发送一个ARP响应消息,包含其MAC地址.

    4. 设备A收到ARP响应后,就可以将数据包发送到设备B的MAC地址了.

    通过这个过程,ARP协议可以将IP地址解析为MAC地址,使得设备可以在网络中进行通信.

#### 2.5 CIDR
CIDR(无类别域间路由)并没有增加IP地址的总数量,它只是改变了IP地址的划分和分配方式.

在CIDR中,IP地址被划分为两部分:网络前缀和主机部分.网络前缀的长度可以是任意的,不再限制为8位/16位或24位.这样,就可以根据网络的实际需求来分配IP地址,避免了传统的A/B/C类地址分配方式中的地址浪费问题.

#### 2.6 为什么本地地址是127.0.0.1?

#### 2.7 网络层分片的原因与具体实现
网络层分片是由IP协议(Internet Protocol)决定的.在IPv4中,如果一个数据包的大小超过了链路层的最大传输单元(MTU),那么IP协议会在网络层进行分片,将大的数据包划分为多个小的数据包,每个小的数据包的大小都不超过MTU.

需要注意的是,在IPv6中,网络层不再进行分片,而是由发送端的传输层进行分片.如果一个数据包的大小超过了MTU,那么发送端需要在传输层将数据包划分为多个小的数据包,然后再发送.这是因为网络层分片会增加网络的复杂性和开销,因此IPv6设计者决定将分片的责任交给发送端.

网络层分片是指在网络层将大的数据包划分为多个小的数据包的过程.这个过程通常发生在数据包的大小超过链路层的最大传输单元(MTU)时.

为什么要进行分片呢?这是因为在链路层中,每种类型的物理介质都有一个最大传输单元(MTU),这是由物理介质的特性决定的.例如,在以太网中,MTU的大小通常是1500字节.如果一个数据包的大小超过了MTU,那么就需要在网络层进行分片,将大的数据包划分为多个小的数据包,每个小的数据包的大小都不超过MTU.

分片的过程是在发送端进行的,接收端收到分片后,会根据分片中的信息将它们重新组装成原来的数据包.这个过程是透明的,也就是说,应用层并不知道数据包被分片和重新组装的过程.

需要注意的是,分片会增加网络的复杂性和开销,因此在设计网络应用时,应尽量避免发送过大的数据包,以减少分片的需要.


### 3. 路由协议

#### 3.1 静态路由是什么?
静态路由就是在路由器上,配置一条一条规则.下一跳是谁就配置下一跳.<br>
MAC头和IP头变与不变.分为欧洲十国游和玄奘西行型<br>
IP头不变,mac变,不换护照欧洲十国游,ip变,换护照玄奘西行.<br>

#### 3.2 对路由协议的了解与介绍.内部网关协议IGP包括RIP,OSPF,和外部网关协议EGP和BGP.
* RIP"路由信息协议(Route Information Protocol)"的简写,主要传递路由信息,通过每隔30秒广播一次路由表,维护相邻路由器的位置关系,同时根据收到的路由表信息使用动态规划的方式计算自己的路由表信息.RIP是一个距离矢量路由协议,最大跳数为16跳,16跳以及超过16跳的网络则认为目标网络不可达.

* OSPF:详见:https://zhuanlan.zhihu.com/p/41341540


### 4. ICMP
#### 4.1 什么是ICMP协议
    ICMP(Internet Control Message Protocol,互联网控制报文协议)是网络层的一个协议.它用于在IP主机/路由器之间传递控制消息,这些控制消息通常被用于IP操作的诊断以及提供有关异常情况的反馈,例如,目标主机不可达/网络拥塞等.

#### 4.2 ICMP工作原理
ICMP(Internet Control Message Protocol,互联网控制报文协议)的工作原理主要涉及发送和接收ICMP报文.ICMP报文通常被用于IP操作的诊断以及提供有关异常情况的反馈.

以下是ICMP的基本工作流程:

1. 当一个设备需要发送一个ICMP报文时(例如,使用ping命令测试网络连通性),它会创建一个ICMP报文,包含一个类型字段(指示报文的类型)和一个代码字段(提供关于报文类型的更多信息),以及其他必要的信息.

2. ICMP报文被封装在IP数据包中,然后发送到目标设备.这个过程中可能会经过多个路由器.

3. 当目标设备收到ICMP报文时,它会根据报文的类型和代码字段来处理报文.例如,如果报文是一个ping请求(ICMP echo request),目标设备会发送一个ping响应(ICMP echo reply).

4. 如果在发送ICMP报文的过程中发生了错误(例如,目标设备不可达),则会发送一个ICMP错误报文到源设备.

通过这个过程,ICMP协议可以帮助我们诊断网络问题,例如,测试网络连通性(使用ping命令),确定数据包的传输路径(使用traceroute命令),等等.

#### 4.3 ping
详见:[Ping原理与ICMP协议](https://www.cnblogs.com/Akagi201/archive/2012/03/26/2418475.html)

ping是使用ICMP协议来进行工作的. ICMP:网络控制报文协议

* 首先,ping命令会构建一个ICMP请求数据包,然后由ICMP协议将这个数据包连同目的IP地址源IP地址一起交给IP协议.
* 然后IP协议就会构建一个IP数据报,并且在映射表中查找目的IP对应的mac地址,将其交给数据链路层.
* 然后数据链路层就会构建一个数据帧,附上源mac地址和目的mac地址发送出去.

目的主机接收到数据帧后,就会检查包上的mac地址与本机mac是否相符,如果相符,就接收并把其中的信息提取出来交给IP协议,IP协议就会将其中的信息提取出来交给ICMP协议.然后构建一个ICMP应答包,用相同的过程发送回去.
