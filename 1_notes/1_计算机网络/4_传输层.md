_tags: 计算机网络
_label: 4

## 传输层
### 1. 基本概念

### 2. 其他

#### 2.1 TCP和UDP的区别
TCP(传输控制协议)和UDP(用户数据报协议)是两种常见的传输层协议,它们有以下主要的区别:

1. **连接性**:TCP是一种面向连接的协议,它在数据传输前需要建立连接.而UDP是一种无连接的协议,它不需要建立连接就可以直接发送数据.

2. **可靠性**:TCP提供了数据传输的可靠性保证,它使用了确认/重传和流量控制等机制来确保数据的正确传输.而UDP不提供数据传输的可靠性保证,它只是简单地将数据发送出去,不关心数据是否能正确到达.

3. **传输方式**:TCP是一种流式协议,它将数据看作是一个无结构的字节流.而UDP是一种数据报协议,它将数据划分为一个个的数据报,每个数据报都独立传输.

4. **速度**:由于TCP需要进行连接建立和可靠性保证,所以它的传输速度通常比UDP慢.而UDP由于没有这些开销,所以它的传输速度通常比TCP快.

5. **应用场景**:TCP通常用于需要可靠传输的应用,例如Web浏览/电子邮件和文件传输等.而UDP通常用于对实时性要求高的应用,例如语音和视频通信/在线游戏等.

以上就是TCP和UDP的主要区别.需要注意的是,选择使用TCP还是UDP需要根据应用的具体需求来决定.

#### 2.2 TCP和UDP相关的协议与端口号
基于TCP的协议:

- HTTP:端口80,用于Web浏览
- HTTPS:端口443,用于安全的Web浏览
- FTP:端口20和21,用于文件传输
- SSH:端口22,用于安全的远程登录
- Telnet:端口23,用于远程登录
- SMTP:端口25,用于电子邮件发送
- POP3:端口110,用于电子邮件接收
- IMAP:端口143,用于电子邮件接收

基于UDP的协议:

- DNS:端口53,用于域名解析
- DHCP:端口67和68,用于动态主机配置
- SNMP:端口161和162,用于简单网络管理
- RTP:端口通常在5000到6000之间,用于实时音视频传输

需要注意的是,以上的端口号都是默认的端口号,实际使用中可以根据需要更改.

#### (7) TCP(UDP,IP)等首部的认识(http请求报文构成)
TCP的头部大致包括:源端口,目的端口,序号,确认号,偏移位,标志位,校验和等等

UDP的头部则包括:源端口,目的端口,长度,校验和.

IP数据包的头部包括:源IP地址,目的IP地址,协议,校验和,总长度等等

详见:https://blog.csdn.net/zhangliangzi/article/details/52554439

# UDP 首部格式

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/d4c3a4a1-0846-46ec-9cc3-eaddfca71254.jpg" width="600"/> </div><br>

首部字段只有 8 个字节,包括源端口/目的端口/长度/检验和.12 字节的伪首部是为了计算检验和临时添加的.

# TCP 首部格式

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/55dc4e84-573d-4c13-a765-52ed1dd251f9.png" width="700"/> </div><br>

-   **序号**   :用于对字节流进行编号,例如序号为 301,表示第一个字节的编号为 301,如果携带的数据长度为 100 字节,那么下一个报文段的序号应为 401.

-   **确认号**   :期望收到的下一个报文段的序号.例如 B 正确收到 A 发送来的一个报文段,序号为 501,携带的数据长度为 200 字节,因此 B 期望下一个报文段的序号为 701,B 发送给 A 的确认报文段中确认号就为 701.

-   **数据偏移**   :指的是数据部分距离报文段起始处的偏移量,实际上指的是首部的长度.

-   **确认 ACK**   :当 ACK=1 时确认号字段有效,否则无效.TCP 规定,在连接建立后所有传送的报文段都必须把 ACK 置 1.

-   **同步 SYN**   :在连接建立时用来同步序号.当 SYN=1,ACK=0 时表示这是一个连接请求报文段.若对方同意建立连接,则响应报文中 SYN=1,ACK=1.

-   **终止 FIN**   :用来释放一个连接,当 FIN=1 时,表示此报文段的发送方的数据已发送完毕,并要求释放连接.

-   **窗口**   :窗口值作为接收方让发送方设置其发送窗口的依据.之所以要有这个限制,是因为接收方的数据缓存空间是有限的.

#### 先来解释一下UDP
* UDP其实继承了IP包的属性 **不保证不丢失,不保证按顺序到达**<br>
* UDP继承了IP的特性, **基于数据报的,一个一个地发** 📦📦📦<br>
* UDP 我发,我发,我发发发. **who cares!**<br>
* UDP是一个 **无状态的服务**.<br>
#### 对比TCp
* TCP提供可靠交付.**无差错/不丢失/不重复/并且按序到达**<br>
* TCP面向 **字节流**.像水一样.(like water)🌊🌊🌊
* TCP可以有 **拥塞控制的**.会意识到包丢弃了或者网络环境不好了,会根据情况调整自己的行为(慢启动)<br>
* TCP是一个 **有状态服务**,清楚记录发送的包,接收的包,累计确认.<br>

### TCP老司机与UDP愣头青
要讲TCP肯定要与UDP一起讲,这两个的区别,报文头以及传输方式,一个是流一个是包,确实很多不一样.那么我们先来看看简单的UDP,先看一下UDP头<br>
![udp报文](./img/udp_protocol.jpg)<br>
可以看到udp包仅有源端口(16)和目的端口号(16),UDP长度(16)以及UDP校验码(16),与可靠的TCP相比,实在是简单得一塌糊涂.<br>
我们来看一下TCP的头<br>
![tcp报文](./img/tcp_protocol.jpg)<br>
看到了吧,tcp头的格式,特别复杂,但是作为一名靠谱的老司机🚗,内心是需要复杂一点.<br>

所以说UDP套一个ip头之后,就可以在数据链路层奔跑⛓️.跑到那里呢?跑到ip地址对应的位置,找到端口号,要是在中途遭人打劫,或杀害,也没人管.<br>
如果MAC层定义了本地局域网的传输行为,IP层定义了整个网络端到端的传输行为,传输层叫段,我们笼统地叫包📦.**包单独传输,自行选路,在不同的设备封装解封装,不保证到达**.所以UDP也是这样,愣头青.<br>
#### 8位协议定真身
那么包是发送了,收到的机器怎么知道是UDP呢?还是TCP?要知道,TCP和UDP可以发送数据到同一个端口,而应用程序监听这个端口号,这时候,IP头就起作用了,它会有一个8位的协议,存放,区分TCP还是UDP.<br>
所以基于如此简单的结构,在整个网络中,某些机器的操作系统未形成或者还没获取ip地址的时候,或者广播📢或者多播的时候就是用的UDP协议,例如 **DHCP就是基于UDP包的,VXLAN协议也是要用到组播的,也是基于UDP协议的**.<br>
同时因为时延低,不用重连,往往UDP会被用于流媒体,实时游戏,IOT物联网以及移动通信📱.而且最有意思的是Google推出了QUIC就是基于UDP协议的一种改进的通信协议,降低网络通信时延,提供更好的用户互动体验.而QUIC与HTTP一起在应用层上,后面我还会在应用层讲述<br>
讲完了UDP,我们知道它简单得一塌糊涂,很多人都可以对他进行二次开发,进而降低网络通信时延,提供更好的服务.<br>
