## HTTPS 安全相关：数字签名、数字证书、TLS

### 1. 概念

#### 1.1 什么是 HTTPS？

HTTPS（HyperText Transfer Protocol Secure）是 HTTP 的安全版本，通过 SSL/TLS 协议对数据进行加密传输，确保数据的机密性和完整性。相比 HTTP，HTTPS 提供了更高的安全性，防止数据在传输过程中被窃取或篡改。

[HTTP vs HTTPS](https://snailclimb.gitee.io/javaguide/#/./docs/cs-basics/network/http&https)

#### 1.2 数字证书

数字证书是由权威 CA（Certificate Authority）颁发的，用于验证网站身份和加密通信。数字证书包含网站的信息和 CA 的签名。

- **工作原理**：
  1. 权威 CA 使用私钥将网站 A 的信息和消息摘要（签名 S）进行加密打包，形成数字证书，并将公钥提供给客户端。
  2. 网站 A 将自己的信息和数字证书发给客户端。
  3. 客户端用 CA 的公钥对数字证书进行解密，得到签名 S，并与手动计算的网站信息的消息摘要结果 S* 进行对比。
  4. 如果签名一致，证明网站 A 可以信任。

### 2. HTTPS 的具体实现与安全性

HTTPS 包括非对称加密和对称加密两个阶段。在客户端与服务器建立连接时使用非对称加密，连接建立后使用对称加密。

#### 2.1 HTTPS 加密流程

1. 客户端使用 HTTPS 的 URL 访问 Web 服务器，要求与 Web 服务器建立 SSL 连接。
2. Web 服务器收到客户端请求后，将网站的公钥传送给客户端，私钥自己保存。
3. 客户端的浏览器根据双方同意的安全等级，生成对称加密使用的密钥（会话密钥），然后利用网站的公钥将会话密钥加密，并传送给网站。
4. Web 服务器利用自己的私钥解密出会话密钥。
5. Web 服务器利用会话密钥加密与客户端之间的通信，这个过程是对称加密的过程。

服务器第一次传给客户端的公钥其实是 CA 对网站信息进行加密的数字证书。客户端的对称加密密钥是三个随机数的哈希值（1. 客户端第一次给服务端发送请求时附带的随机数 2. 服务器返回时的随机数 3. 客户端收到返回时的随机数）。

### 3. 重放与篡改

#### 3.1 重放攻击

重放攻击是指黑客通过截取的包，重复发送多次，达到攻击服务端的目的。为了防止重放攻击，可以使用唯一的时间戳（timestamp）和随机数（nonce）联合起来，做一个不可逆的签名来保证请求的唯一性。

- **防御措施**：
  1. 验证签名是否合理，确保请求参数没有被篡改。
  2. 验证时间戳是否过期，确保请求是在最近 60 秒内发出的。
  3. 验证随机数是否已存在，确保请求不是 60 秒内的重放请求。

#### 3.2 篡改攻击

篡改攻击是指黑客在数据传输过程中对数据进行修改。为了防止篡改攻击，可以使用消息摘要（如 SHA-256）和数字签名技术，确保数据的完整性和真实性。

### 4. HTTP 和 HTTPS 的区别

1. **安全性**：HTTP 是明文传输，HTTPS 通过 SSL/TLS 加密传输，提供更高的安全性。
2. **端口**：HTTP 使用端口 80，HTTPS 使用端口 443。
3. **连接方式**：HTTP 是无状态的，HTTPS 是由 SSL+HTTP 协议构建的可进行加密传输和身份认证的网络协议。
4. **证书**：HTTPS 需要到 CA 申请证书，通常需要一定费用。

### 5. 由 HTTP 升级为 HTTPS 的操作步骤

1. **申请数字证书**：从权威 CA 申请数字证书。
2. **配置服务器**：在服务器上安装和配置数字证书。
3. **修改网站链接**：将网站的所有 HTTP 链接修改为 HTTPS 链接。
4. **重定向**：设置 HTTP 到 HTTPS 的重定向，确保所有访问都使用 HTTPS。
5. **测试**：测试网站的 HTTPS 连接，确保没有安全漏洞。

通过以上步骤，可以将网站从 HTTP 升级为 HTTPS，提供更高的安全性和用户信任度。

### 参考链接

- [HTTP vs HTTPS](https://snailclimb.gitee.io/javaguide/#/./docs/cs-basics/network/http&https)
- [HTTPS 加密流程](https://github.com/HXWfromDJTU/blog/blob/master/network/http/https.md)
- [Ping 原理与 ICMP 协议](https://www.cnblogs.com/Akagi201/archive/2012/03/26/2418475.html)

通过理解 HTTPS 的基本概念、实现过程和安全性措施，可以更好地设计和管理安全的网络通信。