_tags: c++, string, unicode
_label: -1

## 字符和unicode标准

### 1. 数据类型
在编程语言中，字符的数据类型决定了可以存储哪些字符以及如何存储这些字符。
在 C 和 C++ 中，有两种主要字符类型
* char
    * 主要用于ASCII
* wchar_t
    * 主要用于Unicode
    * 在Windows平台上,`wchar_t`通常是2字节,使用UTF-16编码.当你在代码中写`wchar_t hello_w[] = L"你好你好你好";`时,`L`前缀告诉编译器这是一个宽字符字符串字面量.编译器会将这个字符串转换为UTF-16编码的宽字符序列,每个宽字符都是一个`wchar_t`.这个转换过程是在编译时完成的,所以它不受运行时环境的影响.
    * 需要注意的是,这个行为是特定于Windows平台的.在其他平台上,`wchar_t`可能是4字节,使用UTF-32编码.在这种情况下,"你"和"好"这两个字符也都会被编码为一个4字节的`wchar_t`.
    * 总的来说,`wchar_t`的大小和编码方式取决于具体的编译器和平台,而不是字符本身.在Windows平台上,`wchar_t`通常是2字节,使用UTF-16编码.当你在代码中写`wchar_t hello_w[] = L"你好你好你好";`时,`L`前缀告诉编译器这是一个宽字符字符串字面量.编译器会将这个字符串转换为UTF-16编码的宽字符序列,每个宽字符都是一个`wchar_t`.这个转换过程是在编译时完成的,所以它不受运行时环境的影响.
    * 需要注意的是,这个行为是特定于Windows平台的.在其他平台上,`wchar_t`可能是4字节,使用UTF-32编码.在这种情况下,"你"和"好"这两个字符也都会被编码为一个4字节的`wchar_t`.
    * 总的来说,`wchar_t`的大小和编码方式取决于具体的编译器和平台,而不是字符本身.
    * 在Windows平台上,当你在代码中使用`wchar_t`和`L`前缀定义一个宽字符字符串时,编译器会将这个字符串转换为UTF-16编码的宽字符序列.
    
    这个转换过程是在编译时完成的,所以它不受你的输入编码格式的影响.无论你的源代码文件是使用什么编码格式保存的(例如ASCII/UTF-8/GBK等),编译器都会正确地解析这个文件,并将宽字符字符串转换为UTF-16编码.
    需要注意的是,这个行为是特定于Windows平台的.在其他平台上,`wchar_t`可能使用其他的编码方式,例如UTF-32.因此,如果你的代码需要在多个平台上运行,你应该避免依赖于特定的`wchar_t`编码方式.
    在Windows平台上,当你在代码中使用`wchar_t`和`L`前缀定义一个宽字符字符串时,编译器会将这个字符串转换为UTF-16编码的宽字符序列.
    这个转换过程是在编译时完成的,所以它不受你的输入编码格式的影响.无论你的源代码文件是使用什么编码格式保存的(例如ASCII/UTF-8/GBK等),编译器都会正确地解析这个文件,并将宽字符字符串转换为UTF-16编码.
    需要注意的是,这个行为是特定于Windows平台的.在其他平台上,`wchar_t`可能使用其他的编码方式,例如UTF-32.因此,如果你的代码需要在多个平台上运行,你应该避免依赖于特定的`wchar_t`编码方式.

* char16_t
    * c11引入，用于存储utf16
* char32_t
    * c11引入，用于存储utf32

* 总结
`char`和`wchar_t`的主要区别在于它们的长度和编译器对它们的处理方式.

`char`通常用于存储ASCII字符和其他8位编码的字符,如UTF-8.当你在代码中使用`char`定义一个字符串时,编译器通常不会改变字符串的编码.也就是说,如果你的源代码文件是UTF-8编码的,那么`char`字符串也会是UTF-8编码的.

`wchar_t`则是一个宽字符类型,用于存储需要更多位数的字符,如UTF-16或UTF-32字符.当你在代码中使用`wchar_t`和`L`前缀定义一个宽字符字符串时,编译器会将这个字符串转换为特定的宽字符编码.在Windows平台上,这个编码通常是UTF-16.

### 2. unicode标准
> 简单来说，就是世界上所有主流字符的集合。
Unicode 是一个国际标准，用于为世界上所有的字符、符号和表情符号分配一个唯一的数字。这个数字被称为字符的 Unicode 码点。Unicode 的目标是能够表示所有的写作系统，包括拉丁字母、希腊字母、阿拉伯字母、汉字、象形文字等。

Unicode 标准定义了一系列的字符集，每个字符集包含一组字符和它们对应的码点。例如，基本多语言平面（Basic Multilingual Plane，BMP）是最常用的字符集，它包含了大多数现代语言的字符，以及许多符号和标点符号。

Unicode 标准还定义了一些编码方案，如 UTF-8、UTF-16 和 UTF-32，这些编码方案定义了如何将字符的码点转换为字节序列。这使得 Unicode 字符可以被存储在文件中，或者在网络上进行传输。

总的来说，Unicode 标准是一个全球通用的字符编码系统，它使得我们可以在电脑上使用任何语言进行写作和阅读。

### 3. 编码方案
#### 3.1 ascii
* 控制字符：ASCII 的前 32 个字符（0-31）被定义为控制字符，如换行符（ASCII 10，表示为 \n）、回车符（ASCII 13，表示为 \r）等。这些字符主要用于控制设备，而不是表示可视的字符。
* 可打印字符：ASCII 的后 95 个字符（32-126）被定义为可打印字符，包括英文大小写字母、数字、标点符号和一些特殊字符。
* ASCII 标准本身只定义了 0 到 127 的字符集，这些字符占用 7 位。然而，许多系统和编码标准会使用 8 位（一个字节）来存储字符，这就留下了 128 到 255 的空间可以用于其他字符。
* 这个 128 到 255 的范围通常被用于存储特殊字符，例如各种符号、非英语字母等。具体的字符集取决于使用的编码标准。例如，在 ISO 8859-1（也被称为 Latin-1）编码中，这个范围被用于存储西欧语言中的特殊字符，如 á, ñ, ô 等。
* 然而，需要注意的是，这个 128 到 255 的范围并不是 ASCII 标准的一部分，而是由其他编码标准定义的。在不同的编码标准中，这个范围可能代表不同的字符集。

#### 3.2 utf8
* 在UTF-8编码中，一个字符可能由1到4个字节组成。对于多字节的字符（即2、3、4字节），除了第一个字节外，其余字节的开头都是10。这是UTF-8编码的特性，用于区分多字节字符中的首字节和后续字节。
* 如果第一个字节的最高位是 1，那么你可以通过计算这个字节开头的连续 1 的个数来确定这个字符的字节长度。例如，如果第一个字节是 110xxxxx，那么这个字符就是两个字节长；如果第一个字节是 1110xxxx，那么这个字符就是三个字节长；如果第一个字节是 11110xxx，那么这个字符就是四个字节长。
* 所以UTF-8可以兼容ascii，同时可以支持unicode标准。
* 对于英文字符为大多数的时候，utf8大部分时候都是一个字节的，省空间；因为浪费了比较多的bit去做状态位，而非数据位。在非英文字符为主要内容的时候，经常都是三字节或者四字节的。

#### 3.3 utf16
* 可以用两个字节或者四个字节表示一个字符。
* 具体的编码规则不研究了，应该就是针对utf-8的弱点设计的。即utf8中控制位太多，中文字符等其他语言字符基本都是三四字节。而utf16可以使得中文字符都是两个字节表示，一些不常用的才是四字节。

#### 3.4 utf32
* 统一四个字节表示每一个字符。
* 字符处理：由于 UTF-32 对每个字符使用固定的 4 个字节，所以在处理字符时，可以直接通过索引来访问字符串中的任何字符，而不需要像处理 UTF-8 或 UTF-16 字符串那样进行复杂的计算。这使得 UTF-32 在需要频繁访问或修改字符串中的字符时非常有用。
* 内存空间不是问题：UTF-32 使用的存储空间比 UTF-8 和 UTF-16 多，所以如果内存空间不是问题，而且需要进行大量的字符处理，那么 UTF-32 可能是一个好的选择。
* 兼容性：有些系统或应用可能需要使用 UTF-32 来确保与某些特定的软件或硬件的兼容性。
* 简单来说就是不用解析了。


### 4. 练习

```cpp
#include <iostream>
using namespace std;

int main() {
  char hello[] = "你好你好你好";
  std::cout << sizeof(hello) << std::endl; 
  // 如果你好是通过utf8输入，输出19。
  // 如果你好是通过gbk输入的,输出13
  std::cout << hello << std::endl;

  wchar_t hello_w[] = L"你好你好你好";
  std::cout << sizeof(hello_w) << std::endl; 
  // 输出14, 编译器转成了utf16编码。
  // 不管管"你好"输入是以utf8输入，还是其他编码方案输入。

  return 0;
}
```

