## 深度探索C++对象模型

### 1. 关于对象
* c++对象的封装成本是什么
  * 所有的非静态数据成员,非虚的都存储在对象本身中.
  * 放在class里只有因为virtual带来的额外开销
    * virtual function
    * virtual base class
* c++对象模型
  为了实现多态,即对virtual特性的支持,c++的对象有额外以下内容
  * 成员变量
  * vptr -> vtbl
  ---
  而静态成员变量则是在
* C++对象模型的组成:
  * 所有的非静态数据成员存储在对象本身中.
  * 所有的静态数据成员/成员函数(包括静态与非静态)都置于对象之外.
  * 另用一张虚函数表(virtual table) 存储所有指向虚函数的指针,并在表头附加上一个该类的type_info对象,在对象中则保存一个指向虚函数表的指针.
    ![Alt text](_imgs/image.png)


C++对象模型
### 2. 构造函数语义
### 3. Data语义

### 4. function语义
### 5. 构造/析构/拷贝语义
### 6. 运行时语义

#### c++继承和虚函数 
#### 虚函数的作用 
虚函数如何实现的,画出内存图

* c++继承和虚函数 

##### 深入了解虚拟继承对象模型
为了解决多份拷贝的问题,引入了虚继承,看如下一个🌰
```cpp
class MyClassA:virtual public MyClass
class MyClassB:virtual public MyClass
class MyClassC:public MyClassA,public MyClassB
```
那么除了秉承这个观点还有什么呢?没错,还有一个虚基类表vbtable.虚继承的引入把对象的模型变得十分复杂,除了每个基类(MA和MB)和公共基类(M)的虚函数表指针需要记录📝外,每个虚拟继承了MyClass的父类还需要记录一个虚基类表vbtable的指针vbptr.<br>
![MyClassC的对象模型](./img/Myclass.jpg)<br>
虚基类表每一项记录📝了被继承的虚基类子对象相对于虚基类表指针的偏移量.参考[虚函数与虚继承寻踪](http://www.cnblogs.com/fanzhidongyzby/archive/2013/01/14/2859064.html)<br>

#### 虚继承 虚基类
令所有继承File的都变成虚继承
```cpp
class File{};
class InputFile:virtual public File{};
class OutputFile:virtual public File{};
class IOFile:public InputFile,public OutputFile{};
```
虚继承是一种机制,类通过虚继承指出它希望共享其虚基类的状态.在虚继承下,对给定虚基类,无论该类在派生层次中作为虚基类出现多少次,都只继承一个共享的基类子对象.<br>
这就很好解决了不用复制太多的成员变量.毕竟virtual始终秉承着一个观点,一个接口,你可以多种方法,始终一个接口.后面的实现都会覆盖本来的方法.<br>

#### 多重继承(虚继承)与访问控制 明智而审慎地使用多重继承
多重继承上面其实也有体现,例如Circle继承了Shape,Shape2.多重继承衍生出类层次<br>
* 共享接口: 通过使用类使得重复代码较少,且代码规格同一.通常称为 **运行时多态**或者接口继承
* 共享实现: 代码量较少且实现代码的规格同一,通常称为实现继承.<br>
一个类可以综合应用接口与实现继承.<br>
